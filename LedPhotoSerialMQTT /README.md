# Управление освещением с обменом данными по MQTT

## Описание проекта

В этом проекте реализована простая IoT-система управления освещением.
Один микроконтроллер измеряет уровень освещённости с помощью фоторезистора, второй микроконтроллер управляет светодиодом.

Связь между микроконтроллерами организована через два Python-скрипта и MQTT-брокер.

## Особенности реализации

По условию задания предполагалось использование двух отдельных компьютеров, каждый из которых работает со своим микроконтроллером и обменивается данными через MQTT. В ходе выполнения задания возникли проблемы с запуском `arduino ide` на одном из ноутбуков, поэтому мы решили реализовать данное задание использовав один ноутбук.

### Как мы решили эту проблему

Чтобы всё равно выполнить задание корректно, было принято решение:

* использовать **один ноутбук**;
* подключить к нему **два микроконтроллера**:

  * Arduino Nano - датчик освещённости;
  * Arduino Uno - управление светодиодом;
* каждый Arduino подключён по **отдельному USB-порту**;
* на ноутбуке одновременно запущены три программы:

  * `sensor.py` - отправляет данные в MQTT;
  * `actuator.py` - получает данные и управляет светодиодом;
  * `monitor.py` - показывает все сообщения в системе.

Таким образом, изменение сделано только по технической причине и не меняет суть задания.

## Архитектура системы

```
[Sensor MCU] <--UART--> [PC1: Python + MQTT Publisher]
                              |
                              v
                         [MQTT Broker]
                              |
                              v
[Actuator MCU] <--UART--> [PC2: Python + MQTT Subscriber]


                         [Monitor PC]
                              ^
                              |
                    (подписан на все топики)
```

Логическая архитектура системы соответствует варианту с двумя ПК, описанному в задании.
Физически все компоненты были запущены на одном ноутбуке по техническим причинам, при этом каждый компонент работает как отдельный процесс и взаимодействует через MQTT-брокер.

## Общая схема работы

```
[Arduino Nano]  →  [sensor.py]  →  MQTT Broker  →  [actuator.py]  →  [Arduino Uno]
        |                                                     |
   фоторезистор                                           светодиод
```

Отдельно запускается программа `monitor.py`, которая показывает все сообщения в системе.

## Используемое оборудование

* Один ноутбук
* Arduino Nano — микроконтроллер-датчик
* Arduino Uno — микроконтроллер-исполнитель
* Фоторезистор (подключён к A0 Arduino Nano)
* Светодиод (встроенный LED на пине 13 Arduino Uno)
* USB-кабели для подключения Arduino

## Используемое программное обеспечение

* Arduino IDE
* Python 3
* Библиотеки Python:

  * `pyserial`
  * `paho-mqtt`


## Как работает система

### 1. Arduino Nano (датчик)

Arduino Nano постоянно готов считывать значение с фоторезистора.

Он принимает команды по UART:

* `p` — отправить одно значение освещённости
* `s` — начать отправлять значения каждые 2 секунды

Ответ выглядит так:

```
→ 123
```

---

### 2. sensor.py

Скрипт `sensor.py` работает на ноутбуке и общается с Arduino Nano.

Что он делает:

* отправляет команду `p` на Arduino;
* получает значение освещённости;
* отправляет это значение в MQTT.

Данные публикуются в топик:

```
iot/home/luminosity
```

Также скрипт отправляет сообщения о своём состоянии:

```
iot/home/sensor_status
```

---

### 3. actuator.py

Скрипт `actuator.py` подписывается на MQTT-топик с освещённостью.

Когда приходит новое значение:

* если освещённость меньше заданного порога — включается свет;
* если больше — свет выключается.

Для управления Arduino Uno отправляются команды:

* `u` — включить светодиод
* `d` — выключить светодиод

Состояние света публикуется в:

```
iot/home/light_status
```

---

### 4. Arduino Uno (исполнитель)

Arduino Uno управляет светодиодом.

Он принимает команды:

* `u` — включить LED
* `d` — выключить LED
* `b` — мигание LED

В ответ отправляет текстовые сообщения, например:

```
LED_GOES_ON
LED_GOES_OFF
```

---

### 5. monitor.py

`monitor.py` — это простой монитор системы.

Он:

* подписывается на `iot/home/#`;
* показывает все сообщения и топики;
* помогает проверить, что система работает правильно.

Пример вывода:

```
[12:40:05] iot/home/luminosity → 87
[12:40:05] iot/home/light_status → ON
```

## Используемые MQTT-топики

| Топик                      | Назначение           |
| -------------------------- | -------------------- |
| `iot/home/luminosity`      | Уровень освещённости |
| `iot/home/light_status`    | Состояние светодиода |
| `iot/home/sensor_status`   | Статус датчика       |
| `iot/home/actuator_status` | Статус исполнителя   |

## Проверка работы системы

Во время тестирования было проверено:

* датчик корректно отвечает на команду `p`;
* значения освещённости публикуются в MQTT;
* исполнитель получает данные и управляет LED;
* монитор отображает все сообщения;
* система стабильно работает длительное время.

## Визуализация работы

Видео-демонстрацию на реальных микроконтроллерах можно посмотреть по ссылке https://disk.yandex.ru/i/PZH4zk7O8iNzMQ

Ссылка на tinkercad с работающей симуляцией всей схемы и кода https://www.tinkercad.com/things/8oMkxwk3Q5V-ledphotoserialmqtt


## Итог

В результате была реализована рабочая IoT-система с использованием UART и MQTT.
Все требования задания выполнены, система работает стабильно.